{"ast":null,"code":"import _regeneratorRuntime from\"/Users/drallek/Desktop/Cryptosphere/RowdyPickles/dapp-env/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/drallek/Desktop/Cryptosphere/RowdyPickles/dapp-env/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";// constants\nimport Web3EthContract from\"web3-eth-contract\";import Web3 from\"web3\";// log\nimport{fetchData}from\"../data/dataActions\";var connectRequest=function connectRequest(){return{type:\"CONNECTION_REQUEST\"};};var connectSuccess=function connectSuccess(payload){return{type:\"CONNECTION_SUCCESS\",payload:payload};};var connectFailed=function connectFailed(payload){return{type:\"CONNECTION_FAILED\",payload:payload};};var updateAccountRequest=function updateAccountRequest(payload){return{type:\"UPDATE_ACCOUNT\",payload:payload};};export var connect=function connect(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var abiResponse,abi,configResponse,CONFIG,_window,ethereum,metamaskIsInstalled,web3,accounts,networkId,SmartContractObj;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:dispatch(connectRequest());_context.next=3;return fetch(\"/config/abi.json\",{headers:{\"Content-Type\":\"application/json\",Accept:\"application/json\"}});case 3:abiResponse=_context.sent;_context.next=6;return abiResponse.json();case 6:abi=_context.sent;_context.next=9;return fetch(\"/config/config.json\",{headers:{\"Content-Type\":\"application/json\",Accept:\"application/json\"}});case 9:configResponse=_context.sent;_context.next=12;return configResponse.json();case 12:CONFIG=_context.sent;_window=window,ethereum=_window.ethereum;metamaskIsInstalled=ethereum&&ethereum.isMetaMask;if(!metamaskIsInstalled){_context.next=33;break;}Web3EthContract.setProvider(ethereum);web3=new Web3(ethereum);_context.prev=18;_context.next=21;return ethereum.request({method:\"eth_requestAccounts\"});case 21:accounts=_context.sent;_context.next=24;return ethereum.request({method:\"net_version\"});case 24:networkId=_context.sent;if(networkId==CONFIG.NETWORK.ID){SmartContractObj=new Web3EthContract(abi,CONFIG.CONTRACT_ADDRESS);dispatch(connectSuccess({account:accounts[0],smartContract:SmartContractObj,web3:web3}));// Add listeners start\nethereum.on(\"accountsChanged\",function(accounts){dispatch(updateAccount(accounts[0]));});ethereum.on(\"chainChanged\",function(){window.location.reload();});// Add listeners end\n}else{dispatch(connectFailed(\"Change network to \".concat(CONFIG.NETWORK.NAME,\".\")));}_context.next=31;break;case 28:_context.prev=28;_context.t0=_context[\"catch\"](18);dispatch(connectFailed(\"Something went wrong.\"));case 31:_context.next=34;break;case 33:dispatch(connectFailed(\"Install Metamask.\"));case 34:case\"end\":return _context.stop();}},_callee,null,[[18,28]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var updateAccount=function updateAccount(account){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:dispatch(updateAccountRequest({account:account}));dispatch(fetchData(account));case 2:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};","map":{"version":3,"names":["Web3EthContract","Web3","fetchData","connectRequest","type","connectSuccess","payload","connectFailed","updateAccountRequest","connect","dispatch","fetch","headers","Accept","abiResponse","json","abi","configResponse","CONFIG","window","ethereum","metamaskIsInstalled","isMetaMask","setProvider","web3","request","method","accounts","networkId","NETWORK","ID","SmartContractObj","CONTRACT_ADDRESS","account","smartContract","on","updateAccount","location","reload","NAME"],"sources":["/Users/drallek/Desktop/Cryptosphere/RowdyPickles/dapp-env/src/redux/blockchain/blockchainActions.js"],"sourcesContent":["// constants\nimport Web3EthContract from \"web3-eth-contract\";\nimport Web3 from \"web3\";\n// log\nimport { fetchData } from \"../data/dataActions\";\n\nconst connectRequest = () => {\n  return {\n    type: \"CONNECTION_REQUEST\",\n  };\n};\n\nconst connectSuccess = (payload) => {\n  return {\n    type: \"CONNECTION_SUCCESS\",\n    payload: payload,\n  };\n};\n\nconst connectFailed = (payload) => {\n  return {\n    type: \"CONNECTION_FAILED\",\n    payload: payload,\n  };\n};\n\nconst updateAccountRequest = (payload) => {\n  return {\n    type: \"UPDATE_ACCOUNT\",\n    payload: payload,\n  };\n};\n\nexport const connect = () => {\n  return async (dispatch) => {\n    dispatch(connectRequest());\n    const abiResponse = await fetch(\"/config/abi.json\", {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n      },\n    });\n    const abi = await abiResponse.json();\n    const configResponse = await fetch(\"/config/config.json\", {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n      },\n    });\n    const CONFIG = await configResponse.json();\n    const { ethereum } = window;\n    const metamaskIsInstalled = ethereum && ethereum.isMetaMask;\n    if (metamaskIsInstalled) {\n      Web3EthContract.setProvider(ethereum);\n      let web3 = new Web3(ethereum);\n      try {\n        const accounts = await ethereum.request({\n          method: \"eth_requestAccounts\",\n        });\n        const networkId = await ethereum.request({\n          method: \"net_version\",\n        });\n        if (networkId == CONFIG.NETWORK.ID) {\n          const SmartContractObj = new Web3EthContract(\n            abi,\n            CONFIG.CONTRACT_ADDRESS\n          );\n          dispatch(\n            connectSuccess({\n              account: accounts[0],\n              smartContract: SmartContractObj,\n              web3: web3,\n            })\n          );\n          // Add listeners start\n          ethereum.on(\"accountsChanged\", (accounts) => {\n            dispatch(updateAccount(accounts[0]));\n          });\n          ethereum.on(\"chainChanged\", () => {\n            window.location.reload();\n          });\n          // Add listeners end\n        } else {\n          dispatch(connectFailed(`Change network to ${CONFIG.NETWORK.NAME}.`));\n        }\n      } catch (err) {\n        dispatch(connectFailed(\"Something went wrong.\"));\n      }\n    } else {\n      dispatch(connectFailed(\"Install Metamask.\"));\n    }\n  };\n};\n\nexport const updateAccount = (account) => {\n  return async (dispatch) => {\n    dispatch(updateAccountRequest({ account: account }));\n    dispatch(fetchData(account));\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}